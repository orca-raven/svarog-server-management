# Changelog

Все значимые изменения в проекте Svarog Server Management System будут документированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.0.5] - 2025-10-05

### Добавлено
- Настройки безопасности API в интерфейсе настроек
- Возможность включения/выключения внешнего API доступа
- Middleware для проверки состояния API перед обработкой запросов
- Специальные маршруты для управления настройками API (всегда доступны)
- Предупреждающие сообщения при отключении API

### Изменено
- API по умолчанию отключен для повышения безопасности
- Внутренний функционал системы работает независимо от настроек API
- Обновлена версия в README.md до актуальной (1.0.5)

### Улучшено
- Повышена безопасность системы за счет возможности отключения внешнего API
- Добавлены информативные сообщения о состоянии API
- Улучшен пользовательский интерфейс настроек

## [1.0.4] - 2025-10-05

### Добавлено
- Поддержка macOS в автоматическом установщике install.py
- Создание launchd службы для macOS с автозапуском
- Автоматическая установка Node.js через Homebrew на macOS
- Автоматическая установка Homebrew при его отсутствии
- Логирование службы в файлы для macOS (/usr/local/var/log/)
- Управление службой через launchctl на macOS

### Изменено
- Расширена поддержка операционных систем: Linux, macOS, Windows
- Улучшена логика определения операционной системы (Darwin → macOS)
- Обновлены пути установки для macOS (/usr/local/svarog)
- Расширена документация с инструкциями для macOS

### Исправлено
- Универсальная обработка временных директорий для Unix-систем
- Корректное определение путей к Node.js на macOS
- Улучшена обработка ошибок при создании служб

## [1.0.3] - 2025-10-05

### Добавлено
- Автоматический установщик install.py для Linux систем с поддержкой systemd
- Полная документация проекта в README.md
- Файл .gitignore для исключения временных файлов и базы данных
- Поддержка автоматического поиска свободных портов
- Создание systemd службы "svarog-server" с автозапуском
- Проверка зависимостей и автоматическая установка Node.js на Linux

### Изменено
- Название проекта с "Server Management System" на "Svarog Server Management System"
- Обновлен package.json с новым названием и описанием
- Улучшена структура документации с описанием API и возможностей

### Исправлено
- Стандартизированы названия файлов и путей в документации
- Обновлены инструкции по установке и развертыванию

## [1.0.2] - 2025-10-05

### Исправлено
- Исправлена критическая ошибка дублирования маршрутов API в routes/settings.js
- Исправлена проблема с отображением пустых значений в статистике компонентов
- Исправлена ошибка "SQLITE_ERROR: no such column: name" в тестовых запросах
- Улучшена обработка пустых полей в базе данных при генерации статистики

### Добавлено
- Добавлен тестовый endpoint /api/settings/test-data для диагностики базы данных
- Добавлено расширенное логирование в API статистики компонентов
- Добавлена проверка на пустые и NULL значения в SQL запросах статистики
- Улучшена диагностика проблем соединения с сервером

### Изменено
- Оптимизирован API статистики компонентов для корректной работы с реальными данными
- Упрощена структура SQL запросов для повышения производительности
- Улучшена отладочная информация в консоли сервера

## [1.0.1] - 2025-10-05

### Исправлено
- Исправлена ошибка "сервер вернул неожиданный тип данных" при сохранении форм
- Исправлена ошибка "Cannot read properties of null (reading 'value')" при создании новых карточек
- Исправлена ошибка отображения [object Object] в статистике компонентов на странице настроек
- Добавлены проверки content-type перед парсингом JSON ответов

### Изменено
- Упрощена форма АРМ: убрано поле "Аналитика"
- В блоке CPU для АРМ оставлены только "Модель процессора" и "Количество ОЗУ"
- Блок "Сеть" полностью убран для АРМ (остался только для серверов)
- Блок "Диски" для АРМ переделан по аналогии с виртуальными машинами
- Форма виртуальных машин: поле "Роль" убрано, "Операционная система" сокращено до "ОС" и перенесено в блок "Основная информация"
- Блок "Система" в ВМ переименован в "Комментарии" и содержит только комментарии

### Добавлено
- Безопасный сбор данных форм с проверками существования элементов
- Отдельная логика сбора данных для АРМ и серверов
- Улучшенная обработка ошибок с информативными сообщениями

## [1.0.0] - 2025-10-04

### Добавлено
- Отдельная страница настроек вместо модального окна
- Статистика компонентов с подсчетом в реальном времени
- Валидация данных с проверкой уникальности полей в реальном времени
- Валидация ресурсов серверов виртуализации с предотвращением переподписки
- Темная тема Material Design с улучшенной контрастностью
- Модальные окна размером 90% ширины и 85% высоты экрана
- API endpoint `/api/settings/components-stats` для статистики компонентов
- API endpoint `/api/settings/component-equipment/:type/:value` для просмотра оборудования
- API endpoints для проверки уникальности данных
- Кнопка "Удалить" в модальных окнах с подтверждением действия

### Изменено
- Настройки теперь открываются на отдельной странице `/settings.html`
- Удаление записей действительно удаляет их из базы данных с обновлением статистики
- Цветовая схема изменена с синей на зеленую для лучшей видимости
- Оптимизированы зависимости: убран `body-parser` (используется встроенный Express JSON parser)
- Команда установки зависимостей изменена на точечную установку только необходимых пакетов

### Исправлено
- SQLITE_ERROR с функцией REGEXP заменена на простую сортировку COLLATE NOCASE
- Ошибки JSON парсинга при получении HTML ответов от сервера
- Дублирование компонентов в базе данных при сохранении
- Проблемы с контрастностью шрифтов в темной теме
- Проблемы с сохранением пустых карточек

## [0.9.0] - 2025-10-03

### Добавлено
- Полная система управления серверами, АРМ и виртуальными машинами
- SQLite база данных с автоматической инициализацией
- REST API для всех операций CRUD
- Material Design интерфейс с темной темой
- Система проверки доступности через ping с настраиваемым интервалом
- Импорт/экспорт данных в формате Excel
- Автокомплит для повторяющихся данных
- Натуральная сортировка таблиц
- Проверка ресурсов серверов виртуализации
- Система аналитики с заменой поля "роль" на "аналитика"

### Технические особенности
- Node.js + Express backend
- SQLite база данных
- HTML5, CSS3, JavaScript (ES6+) frontend
- Поддержка ping мониторинга с node-cron
- Обработка Excel файлов с библиотекой xlsx
- CORS поддержка для API
- Автоматические расчеты (общее количество ядер, объемы RAID массивов)

### Структура проекта
```
serverstat_co/
├── public/                 # Фронтенд файлы
│   ├── index.html         # Главная страница
│   ├── settings.html      # Страница настроек
│   ├── styles.css         # Material Design стили (темная тема)
│   ├── script.js          # JavaScript логика главной страницы
│   └── settings.js        # JavaScript логика страницы настроек
├── routes/                # API маршруты
│   ├── servers.js         # Маршруты для серверов
│   ├── arms.js           # Маршруты для АРМ
│   ├── vms.js            # Маршруты для ВМ
│   └── settings.js       # Настройки и утилиты
├── scripts/              # Служебные скрипты
│   └── init-db.js        # Инициализация БД
├── server.js             # Основной сервер
├── package.json          # Конфигурация проекта (минимальные зависимости)
└── database.db           # SQLite база данных (создается автоматически)
```